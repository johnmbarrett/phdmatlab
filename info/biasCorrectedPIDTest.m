values = {...
    [0 0 0; 1 0 1; 0 1 1; 1 1 0]                                ...
    [0 0 0; 1 0 1; 0 1 0; 1 1 1]                                ...
    [0 0 0; 1 0 0; 0 1 0; 1 1 1]                                ...
    [0 0 0; 1 1 0; 0 0 1; 1 1 1]                                ...
    [0 0 0; 1 0 1; 0 1 2; 1 1 3]                                ...
    [0 0 0; 1 1 0]                                              ...
%     [0 0 0; 1 0 0; 0 1 0; 1 1 0; 0 0 1; 1 0 1; 0 1 1; 1 1 1]    ...
%     [0 0 0; 1 0 0; 0 1 0; 1 1 0; 0 0 1; 1 0 1; 0 1 1; 1 1 1]    ...
%     [0 0 0; 1 0 0; 0 1 0; 1 1 0; 0 0 1; 1 0 1; 0 1 1; 1 1 1]    ...
%     [0 0 0; 1 0 0; 0 1 0; 1 1 0; 0 0 1; 1 0 1; 0 1 1; 1 1 1]    ...
%     [0 0 0; 1 0 0; 0 1 0; 1 1 0; 0 0 1; 1 0 1; 0 1 1; 1 1 1]    ...
};
    
probs = {
    [0.25 0.25 0.25 0.25]                                       ...
    [0.25 0.25 0.25 0.25]                                       ...
    [0.25 0.25 0.25 0.25]                                       ...
    [0.1 0.1 0.2 0.6]                                           ...
    [0.25 0.25 0.25 0.25]                                       ...
    [0.5 0.5]                                                   ...
%     [0.9412 0.0173 0.0173 0.0003 0.0192 0.0023 0.0023 0.0001]   ...
%     [0.9412 0.0156 0.0173 0.0019 0.0192 0.0021 0.0023 0.0005]   ...
%     [0.9412 0.0173 0.0173 0.0021 0.0192 0.0004 0.0023 0.0003]   ...
%     [0.9412 0.0156 0.0192 0.0021 0.0192 0.0021 0.0004 0.0003]   ...
%     [0.9412 0.0173 0.0192 0.0023 0.0192 0.0004 0.0004 0.0000]   ...
};

%%
    
ns = ceil(logspace(0.5,4,8));
ts = zeros(1,8,6,0); %zeros(10,10,11);
pids = zeros(1,8,6,5); %zeros(10,10,11,5);

ws1 = warning('off','GetOpt:UnknownOption');
ws2 = warning('off','MATLAB:polyfit:PolyNotUnique');
ws3 = warning('off','MATLAB:polyfit:RepeatedPointsOrRescale');

for ii = 1:8
    n = ns(ii);
    
    for jj = 1 %:10
        for kk = 1:6
%             tic;
            sample = datasample(values{kk},n,'Weights',probs{kk});
            x = sample(:,1);
            y = sample(:,2);
            z = sample(:,3);
%             fprintf('Generated sample in %f seconds\n',toc);

%             tic;
            pids(jj,ii,kk,:) = biasCorrectedPID(z,{x y});
%             ts(jj,ii,kk) = toc;
        end
    end
end

warning(ws3);
warning(ws2);
warning(ws1);

ts = squeeze(ts);
pids = squeeze(pids);

%%

goals = permute(                    ...
    [[[                             ...
        0 0 0 1 1;                  ...
        0 1 0 0 1;                  ...
        0.311 0 0 0.5 0.811;        ...
        0.0323 0 0 0 0.0323;        ...
        1 0 0 1 2;                  ...
        0 0 0 0 0];                 ...
%         [3.061 0 0 3.178 6.239;     ...
%         3.498 0 0.303 2.950 6.750;  ...
%         0.053 0 3.473 0 3.527;      ...
%         0.050 3.175 0 0 3.225;      ...
%         0 0 0 0 0]/1000             ...
    ] zeros(6,1)],                 ...
    [3 1 2 4]);

data = cat(3,pids,ts)-repmat(goals(:,:,1:5),8,1);
ylabels = [repmat({'Error (bits)'},1,5) {'Time (seconds)'}];

%%

figure;

for ii = 1:5
    subplot(2,3,ii);
    line(ns([1 end]),[0 0],'Color','k','LineStyle','--');
    hold on;
    plot(repmat(ns',1,6),data(:,:,ii)); %,data(:,:,ii));
%     errorbar(repmat(ns',1,1),permute(nanmean(data(:,:,:,ii),1),[2 3 4 1]),permute(nanstd(data(:,:,:,ii),1),[2 3 4 1]));
    set(gca,'XScale','log');
    xlabel('# Samples');
    ylabel(ylabels(ii));
end